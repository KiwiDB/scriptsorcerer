(function($){var k={animate:animate,destroy:destroy,add:addItem,delete:deleteItem,rebuild:rebuild};$.fn.RadarBadge=function(a){if(typeof arguments[0]==='string'){var b=arguments[1];var c=Array.prototype.slice.call(arguments);c.splice(0,1);if(k[arguments[0]])return k[arguments[0]].apply(this,c);return false}else{return init.apply(this,arguments)}};function init(b,c){var f=$.extend({},$.fn.RadarBadge.defaults.svgAttrs,b.svgAttrs?b.svgAttrs:{});var g=$.extend({},$.fn.RadarBadge.defaults,b);g.start.call(this);return this.each(function(){var e=$(this);var a=$.meta?$.extend({},g,$this.data()):g;if((!c||!c.dontsave)&&(a.saveData)){var s=$("<div>").addClass("radardata");s.html(JSON.stringify(a));e.append(s)}else if(c&&c.loadsave){var d=getSavedData(e);if(d)a=$.extend({},d,b);if(!a.mouseover)a.mouseover=$.fn.RadarBadge.defaults.mouseover;if(!a.click)a.click=$.fn.RadarBadge.defaults.click;if(!a.coToIndx)a.coToIndx=$.fn.RadarBadge.defaults.coToIndx}if(a.animationDuration<1)a.animationDuration=1;var s=$("<svg width='0' height='0'>").attr(f);l.o=a;l.callbacks={mo:a.mouseover,click:a.click,coToIndx:a.coToIndx};s.bind("mousemove",mo);s.bind("click",clk);s.bind("mouseout",a.mouseout);e.append(s);draw(s,a);draw_chart(s,a);if(a.autoAnimate)animate.apply($(this),a)})}function draw(e,o){var b="http://www.w3.org/2000/svg";var w=parseInt(e.attr("width"));var h=parseInt(e.attr("height"));if((w==h)||(w<h))circle_radius=w*o.circlePortion;else circle_radius=h*o.circlePortion;circle_center=[w/2,h/2];l.circle={radius:circle_radius,center:circle_center};var c=document.createElementNS(b,"circle");c.setAttributeNS(null,"class","radar-bg");c.setAttributeNS(null,"cx",circle_center[0]);c.setAttributeNS(null,"cy",circle_center[1]);c.setAttributeNS(null,"r",circle_radius);e.append(c);var d=document.createElementNS(b,"g");d.setAttributeNS(null,"class","radar-levels");for(i=0;i<o.maxLevels;i++){c=document.createElementNS(b,"circle");c.setAttributeNS(null,"cx",circle_center[0]);c.setAttributeNS(null,"cy",circle_center[1]);c.setAttributeNS(null,"r",circle_radius*(1/o.maxLevels)*i);d.appendChild(c)}e.append(d);if(o.useCenterDot){c=document.createElementNS(b,"circle");c.setAttributeNS(null,"class","radar-centerdot");c.setAttributeNS(null,"cx",250);c.setAttributeNS(null,"cy",250);c.setAttributeNS(null,"r",o.centerDotSize);e.append(c)}l.moRanges=[];for(var i=1;i<=o.items.length;i++){var a={};a=calc_morange(i,o.items.length);a.count=i%o.items.length;l.moRanges.push(a)}};function draw_chart(e,o){var a=document.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#Animation","1.0");var b="http://www.w3.org/2000/svg";var c=[];for(var i=0;i<o.items.length;i++){var d={};d.circ_part=(2/o.items.length)*i;d.radians=(d.circ_part*Math.PI)-(Math.PI/2);d.point_cir=[l.circle.radius*Math.cos(d.radians)+l.circle.center[0],l.circle.radius*Math.sin(d.radians)+l.circle.center[1]];d.point_txt=[l.circle.radius*o.textDistance*Math.cos(d.radians)+l.circle.center[0],l.circle.radius*o.textDistance*Math.sin(d.radians)+l.circle.center[1]];d.path_point=[l.circle.radius*(o.items[i].level/o.maxLevels)*Math.cos(d.radians)+l.circle.center[0],l.circle.radius*(o.items[i].level/o.maxLevels)*Math.sin(d.radians)+l.circle.center[1]];d.label=o.items[i].label;d.id=o.items[i].id;c.push(d)}if(c[0]){var f="M"+(c[0].path_point[0])+" "+(c[0].path_point[1]);var g="M"+l.circle.center[0]+" "+l.circle.center[1];if(o.usePointDots){var h=document.createElementNS(b,"g");h.setAttributeNS(null,"class","radar-points")}var j=document.createElementNS(b,"g");j.setAttributeNS(null,"class","radar-labels");j.setAttributeNS(null,"style","opacity:0");if(a){myAnimation=document.createElementNS(b,"animate");myAnimation.setAttributeNS(null,"begin","infinite");myAnimation.setAttributeNS(null,"attributeType","CSS");myAnimation.setAttributeNS(null,"attributeName","opacity");myAnimation.setAttributeNS(null,"from","0");myAnimation.setAttributeNS(null,"to","1");myAnimation.setAttributeNS(null,"dur",(o.animationDuration/1000)+"s");myAnimation.setAttributeNS(null,"calcMode","spline");myAnimation.setAttributeNS(null,"keySplines","0 0.75 0.25 1");myAnimation.setAttributeNS(null,"fill","freeze");j.appendChild(myAnimation)}else j.setAttributeNS(null,"style","opacity:1");for(var i=0;i<c.length;i++){if(i!=0){f+=" L"+(c[i].path_point[0])+" "+(c[i].path_point[1]);g+=" L"+l.circle.center[0]+" "+l.circle.center[1]}myCircle=document.createElementNS(b,"text");myCircle.setAttributeNS(null,"id","radar_text_"+c[i].id);myCircle.setAttributeNS(null,"x",c[i].point_txt[0]);myCircle.setAttributeNS(null,"y",c[i].point_txt[1]);if(c[i].point_txt[0]>l.circle.center[0])myCircle.setAttributeNS(null,"class","left");else if(c[i].point_txt[0]==l.circle.center[0])myCircle.setAttributeNS(null,"class","middle");else myCircle.setAttributeNS(null,"class","right");myCircle.textContent=c[i].label;j.appendChild(myCircle);if(o.usePointDots){myCircle=document.createElementNS(b,"circle");myCircle.setAttributeNS(null,"r",o.pointDotsSize);if(a){myAnimation=document.createElementNS(b,"animate");myAnimation.setAttributeNS(null,"attributeName","cx");myAnimation.setAttributeNS(null,"begin","0s");myAnimation.setAttributeNS(null,"dur",(o.animationDuration/1000)+"s");myAnimation.setAttributeNS(null,"from",l.circle.center[0]);myAnimation.setAttributeNS(null,"to",c[i].path_point[0]);myAnimation.setAttributeNS(null,"calcMode","spline");myAnimation.setAttributeNS(null,"keySplines","0 0.75 0.25 1");myAnimation.setAttributeNS(null,"fill","freeze");myAnimation.setAttributeNS(null,"begin","infinite");myCircle.appendChild(myAnimation);myAnimation=document.createElementNS(b,"animate");myAnimation.setAttributeNS(null,"attributeName","cy");myAnimation.setAttributeNS(null,"begin","0s");myAnimation.setAttributeNS(null,"dur",(o.animationDuration/1000)+"s");myAnimation.setAttributeNS(null,"from",l.circle.center[1]);myAnimation.setAttributeNS(null,"to",c[i].path_point[1]);myAnimation.setAttributeNS(null,"calcMode","spline");myAnimation.setAttributeNS(null,"keySplines","0 0.75 0.25 1");myAnimation.setAttributeNS(null,"fill","freeze");myAnimation.setAttributeNS(null,"begin","infinite");myCircle.appendChild(myAnimation)}else{myCircle.setAttributeNS(null,"cx",c[i].path_point[0]);myCircle.setAttributeNS(null,"cy",c[i].path_point[1])}h.appendChild(myCircle)}}e.append(j);f+=" Z";g+=" Z";myCircle=document.createElementNS(b,"path");myCircle.setAttributeNS(null,"class","radar-badgeset");if(a){myCircle.setAttributeNS(null,"d",g);myAnimation=document.createElementNS(b,"animate");myAnimation.setAttributeNS(null,"attributeName","d");myAnimation.setAttributeNS(null,"begin","0s");myAnimation.setAttributeNS(null,"dur",(o.animationDuration/1000)+"s");myAnimation.setAttributeNS(null,"from",g);myAnimation.setAttributeNS(null,"to",f);myAnimation.setAttributeNS(null,"calcMode","spline");myAnimation.setAttributeNS(null,"keySplines","0 0.75 0.25 1");myAnimation.setAttributeNS(null,"fill","freeze");myAnimation.setAttributeNS(null,"begin","infinite");myCircle.appendChild(myAnimation)}else{myCircle.setAttributeNS(null,"d",f)}e.append(myCircle);if(o.usePointDots)e.append(h)}};function getSavedData(e){var a=e.find(".radardata");if(a){var d=a.html();try{d=$.parseJSON(d);return d}catch(e){}}return false}function saveData(e,d){var a=e.find(".radardata");if(a){a.html(JSON.stringify(d));return true}return false}function animate(o){this.each(function(){var e=$(this);$(e).find("animate").each(function(){$(this).get(0).beginElement()})})}function rebuild(o){return this.each(function(){var d=getSavedData($(this));if(d){for(i in d.newItems){d.items.push(d.newItems[i])}d.newItems=[];var a=[];for(i in d.delItems){for(j in d.items){if(d.items[j].id==d.delItems[i]){a.push(j)}}}d.delItems=[];var b=[];for(i in d.items){if($.inArray(i,a)==-1)b.push(d.items[i])}d.items=b;saveData($(this),d)}destroy.call($(this));init.call($(this),o?o:{},{"dontsave":true,"loadsave":true})})}function destroy(){return this.each(function(){$(this).find("*").remove()})}function addItem(i){return this.each(function(){var d=getSavedData($(this));if(d){for(it in i)d.newItems.push(i[it]);saveData($(this),d)}})}function deleteItem(i){return this.each(function(){var d=getSavedData($(this));if(d){for(it in i)d.delItems.push(i[it]);saveData($(this),d)}})}function calc_morange(i,n){var a=(360/n)*i;return{s:(a-(360/(n*2)))%360,e:(a+(360/(n*2)))%360}};function coToIndx(x,y){var b=(180/Math.PI);if(x>=0&&y>0)var a=Math.atan(x/y)*b;else if(x<0&&y>=0)var a=270+(Math.atan(Math.abs(y/x))*b);else if(x>=0&&y<0)var a=90+(Math.atan(Math.abs(y/x))*b);else var a=180+(Math.atan(Math.abs(x/y))*b);ind=false;for(sec in l.moRanges){if(l.moRanges[sec].s<l.moRanges[sec].e){if((a>=l.moRanges[sec].s)&&(a<l.moRanges[sec].e)){ind=l.moRanges[sec].count;break}}else{if((a>=l.moRanges[sec].s&&a<=360)||(a<l.moRanges[sec].e&&a>=0)){ind=l.moRanges[sec].count;break}}}return ind};function mo(e){t=$(e.target);if(!t.is("svg"))t=t.closest("svg");t=t.get(0);ol=t.getBoundingClientRect().left;ot=t.getBoundingClientRect().top;x=e.clientX-ol-l.circle.center[0];y=(e.clientY-ot-l.circle.center[1])*-1;var a=l.callbacks.coToIndx.call(null,x,y);l.callbacks.mo.call(null,e,a!==false?l.o.items[a]:false)};function clk(e){t=$(e.target);if(!t.is("svg"))t=t.closest("svg");t=t.get(0);ol=t.getBoundingClientRect().left;ot=t.getBoundingClientRect().top;x=e.clientX-ol-l.circle.center[0];y=(e.clientY-ot-l.circle.center[1])*-1;var a=l.callbacks.coToIndx.call(null,x,y);l.callbacks.click.call(null,e,a!==false?l.o.items[a]:false)};var l={moRanges:[]};$.fn.RadarBadge.defaults={items:[],newItems:[],delItems:[],maxLevels:5,svgAttrs:{"class":"radar-badge",width:500,height:500},circlePortion:0.25,useCenterDot:true,centerDotSize:3,textDistance:1.25,usePointDots:true,pointDotsSize:3,autoAnimate:true,animationDuration:1000,saveData:false,start:function(){},mouseover:function(){},mouseout:function(){},click:function(){},coToIndx:coToIndx}}(jQuery));